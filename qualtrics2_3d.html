<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Graph</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .graph-container {
      display: flex;
      gap: 20px;
      justify-content: space-around;
    }

    .graph-box {
      width: 48%;
      border: 1px solid black;
      padding: 10px;
      box-sizing: border-box;
    }

    .graph-title {
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .plot {
      width: 100%;
      height: 600px;
    }
  </style>
</head>

<body>
  <h2>Graphs</h2>
  <div class="graph-container">
    <div class="graph-box">
      <div class="graph-title">A</div>
      <div id="plotA" class="plot"></div>
    </div>
    <div class="graph-box">
      <div class="graph-title">B</div>
      <div id="plotB" class="plot"></div>
    </div>
  </div>

  <script>
    async function loadGraphData(edgeFile, layoutFile) {
      const [edgeData, nodeData] = await Promise.all([
        d3.dsv(";", edgeFile),
        d3.dsv(";", layoutFile)
      ]);

      const edges = edgeData.map(d => [parseInt(d.from), parseInt(d.to)]);
      const nodes = nodeData.map(d => ({
        x: parseFloat(d.x),
        y: parseFloat(d.y),
        z: parseFloat(d.z)
      }));

      return { edges, nodes };
    }

    function createTraces(edges, nodes) {
      const edgeX = [], edgeY = [], edgeZ = [];
      for (const [src, tgt] of edges) {
        const { x: x0, y: y0, z: z0 } = nodes[src];
        const { x: x1, y: y1, z: z1 } = nodes[tgt];
        edgeX.push(x0, x1, null);
        edgeY.push(y0, y1, null);
        edgeZ.push(z0, z1, null);
      }

      const edgeTrace = {
        x: edgeX,
        y: edgeY,
        z: edgeZ,
        mode: 'lines',
        type: 'scatter3d',
        line: { width: 1, color: '#888' },
        hoverinfo: 'none'
      };

      const nodeTrace = {
        x: nodes.map(n => n.x),
        y: nodes.map(n => n.y),
        z: nodes.map(n => n.z),
        mode: 'markers',
        type: 'scatter3d',
        marker: { size: 3, color: '#1f77b4' },
        text: nodes.map((_, i) => String(i)),
        hoverinfo: 'text'
      };

      return [edgeTrace, nodeTrace];
    }

    async function renderGraph(edgeFile, layoutFile, plotId) {
      const { edges, nodes } = await loadGraphData(edgeFile, layoutFile);
      const traces = createTraces(edges, nodes);

      const layout = {
        margin: { t: 20 },
        dragmode: 'orbit',
        scene: {
          xaxis: { visible: false, showgrid: false, range: [0, 1] },
          yaxis: { visible: false, showgrid: false, range: [0, 1] },
          zaxis: { visible: false, showgrid: false, range: [0, 1] }
        },
        showlegend: false
      };

      Plotly.newPlot(plotId, traces, layout);
    }

    renderGraph("data/dwt_1005.csv", "layouts/dwt_1005-3d.csv", "plotA");
    renderGraph("data/dwt_1005_1.csv", "layouts/dwt_1005_1-3d.csv", "plotB");
    renderGraph("data/dwt_1005_2.csv", "layouts/dwt_1005_2-3d.csv", "plotC");
  </script>
</body>
</html>