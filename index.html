<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Graph</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h2>Graph</h2>
  <div id="plot" style="width: 100%; height: 600px;"></div>

  <script>
    async function loadAndDrawGraph() {
      const response = await fetch('data/test.csv');
      const csvText = await response.text();

      // Parse CSV into edge list
      const lines = csvText.trim().split('\n');
      const headers = lines[0].split(';');
      const fromIndex = headers.indexOf('from');
      const toIndex = headers.indexOf('to');

      const edges = lines.slice(1).map(line => {
          const columns = line.split(';');
          return [parseInt(columns[fromIndex]), parseInt(columns[toIndex])];
        });

      // Get unique nodes
      const nodes = [...new Set(edges.flat())];
      const nodeIndices = new Map(nodes.map((n, i) => [n, i]));

      // Generate random node positions (or replace with actual layout)
      const positions = nodes.map(() => [Math.random(), Math.random(), Math.random()]);

      // Create edge traces
      const edgeX = [], edgeY = [], edgeZ = [];
      for (const [src, tgt] of edges) {
        const [x0, y0, z0] = positions[nodeIndices.get(src)];
        const [x1, y1, z1] = positions[nodeIndices.get(tgt)];
        edgeX.push(x0, x1, null);
        edgeY.push(y0, y1, null);
        edgeZ.push(z0, z1, null);
      }

      const edgeTrace = {
        x: edgeX,
        y: edgeY,
        z: edgeZ,
        mode: 'lines',
        type: 'scatter3d',
        line: { width: 1, color: '#888' },
        hoverinfo: 'none'
      };

      // Create node traces
      const nodeX = positions.map(pos => pos[0]);
      const nodeY = positions.map(pos => pos[1]);
      const nodeZ = positions.map(pos => pos[2]);

      const nodeTrace = {
        x: nodeX,
        y: nodeY,
        z: nodeZ,
        mode: 'markers+text',
        type: 'scatter3d',
        marker: {
          size: 10,
          color: '#1f77b4'
        },
        text: nodes.map(String),
        textposition: 'top center',
        hoverinfo: 'text'
      };

      Plotly.newPlot('plot', [edgeTrace, nodeTrace], {
        margin: { t: 20 },
        xaxis: { visible: false },
        yaxis: { visible: false },
        zaxis: { visible: false },
        showlegend: false
      });
    }

    loadAndDrawGraph();
  </script>
</body>
</html>