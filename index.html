<!DOCTYPE html>
<html>
<head>
  <title>3D Node-Link Graph</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
</head>
<body>
  <h1>3D Graph in Pyodide</h1>
  <div id="plot" style="width: 100%; height: 700px;"></div>

  <script>
    async function main() {
      const pyodide = await loadPyodide();
      await pyodide.loadPackage(["numpy", "micropip"]);

      await pyodide.runPythonAsync(`
import micropip
await micropip.install(["plotly", "networkx"])
      `);

      await pyodide.runPythonAsync(`
import numpy as np
import networkx as nx
import plotly.graph_objects as go
import js

# Create a graph
G = nx.random_geometric_graph(20, 0.4)
pos = nx.spring_layout(G, dim=3, seed=42)
nodes = np.array([pos[n] for n in G.nodes()])
edges = [(pos[u], pos[v]) for u, v in G.edges()]

# Edge traces
edge_x = []
edge_y = []
edge_z = []

for edge in edges:
    x0, y0, z0 = edge[0]
    x1, y1, z1 = edge[1]
    edge_x += [x0, x1, None]
    edge_y += [y0, y1, None]
    edge_z += [z0, z1, None]

edge_trace = go.Scatter3d(
    x=edge_x, y=edge_y, z=edge_z,
    line=dict(width=2, color='black'),
    hoverinfo='none',
    mode='lines'
)

# Node trace
node_x, node_y, node_z = nodes[:, 0], nodes[:, 1], nodes[:, 2]
node_trace = go.Scatter3d(
    x=node_x, y=node_y, z=node_z,
    mode='markers',
    marker=dict(size=6, color='blue', opacity=0.8),
    hoverinfo='text',
    text=[f"Node {i}" for i in G.nodes()]
)

fig = go.Figure(data=[edge_trace, node_trace])
fig.update_layout(
    showlegend=False,
    margin=dict(l=0, r=0, b=0, t=0),
    scene=dict(xaxis=dict(visible=False),
               yaxis=dict(visible=False),
               zaxis=dict(visible=False))
)

js.Plotly.newPlot('plot', fig.to_plotly_json())
      `);
    }

    main();
  </script>
</body>
</html>